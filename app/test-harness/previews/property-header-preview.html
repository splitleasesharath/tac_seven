<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PropertyHeader Component Preview - Split Lease</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
      background: #f5f5f5;
      padding: 0;
      margin: 0;
    }

    .preview-header {
      background: white;
      padding: 1.5rem 2rem;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .preview-header h1 {
      font-size: 1.5rem;
      color: #111827;
      margin-bottom: 0.5rem;
    }

    .preview-header p {
      color: #6B7280;
      font-size: 0.875rem;
    }

    .preview-header code {
      background: #F3F4F6;
      padding: 0.125rem 0.375rem;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-size: 0.8125rem;
    }

    .test-controls {
      background: white;
      padding: 1.5rem 2rem;
      margin: 1.5rem;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .test-controls h2 {
      font-size: 1.125rem;
      color: #111827;
      margin-bottom: 1rem;
    }

    .spacer {
      height: 2rem;
      background: #f5f5f5;
    }

    .component-container {
      background: white;
      margin: 1.5rem;
      padding: 2rem;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .console-output {
      background: white;
      margin: 1.5rem;
      padding: 1.5rem;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .console-output h3 {
      font-size: 1rem;
      color: #111827;
      margin-bottom: 1rem;
    }

    .console-log {
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 1rem;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-size: 0.875rem;
      max-height: 400px;
      overflow-y: auto;
      line-height: 1.5;
    }

    .console-log .log-entry {
      margin-bottom: 0.5rem;
      padding: 0.25rem 0;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    .console-log .log-entry:last-child {
      border-bottom: none;
    }

    .console-log .timestamp {
      color: #858585;
      margin-right: 0.5rem;
    }

    .console-log .success {
      color: #4ade80;
    }

    .console-log .error {
      color: #f87171;
    }

    .console-log .info {
      color: #60a5fa;
    }

    .test-status {
      display: flex;
      gap: 0.5rem;
      margin-top: 1rem;
      flex-wrap: wrap;
    }

    .status-badge {
      padding: 0.375rem 0.75rem;
      border-radius: 4px;
      font-size: 0.8125rem;
      font-weight: 500;
    }

    .status-badge.pass {
      background: #D1FAE5;
      color: #065F46;
    }

    .status-badge.fail {
      background: #FEE2E2;
      color: #991B1B;
    }

    .clear-console {
      background: #EF4444;
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.875rem;
      font-weight: 500;
      margin-top: 1rem;
      transition: background 0.2s;
    }

    .clear-console:hover {
      background: #DC2626;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <div class="preview-header">
    <h1>üß™ PropertyHeader Component Preview</h1>
    <p>Project: <strong>split-lease</strong> | Global: <code>window.SplitLeaseComponents.PropertyHeader</code></p>
  </div>

  <!-- Test Controls -->
  <div class="test-controls">
    <h2>üéõÔ∏è Component Status</h2>
    <div class="test-status" id="test-status">
      <span class="status-badge fail">Waiting for component...</span>
    </div>
  </div>

  <div class="spacer"></div>

  <!-- Component Container -->
  <div class="component-container" id="property-header-root"></div>

  <!-- Console Output -->
  <div class="console-output">
    <h3>üìä Console Output</h3>
    <div class="console-log" id="console-output">
      <div class="log-entry">
        <span class="timestamp">[00:00:00]</span>
        <span class="info">Console initialized. Waiting for events...</span>
      </div>
    </div>
    <button class="clear-console" onclick="clearConsole()">Clear Console</button>
  </div>

  <!-- Component CSS (CRITICAL: Must be loaded for styling) -->
  <link rel="stylesheet" href="../../split-lease/components/dist/style.css">

  <!-- React + UMD -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Node globals shim -->
  <script>
    window.global = window;
    window.process = { env: { NODE_ENV: 'production' } };
  </script>

  <!-- Component Bundle -->
  <script src="../../split-lease/components/dist/split-lease-components.umd.cjs"></script>

  <!-- Preview Logic -->
  <script>
    // Test tracking
    const tests = {
      componentLoaded: false,
      componentRendered: false,
      titleRendered: false,
      locationRendered: false,
      mapPinVisible: false,
      detailsRendered: false
    };

    // Console capture
    const consoleOutput = document.getElementById('console-output');
    const testStatusEl = document.getElementById('test-status');

    function getTimestamp() {
      const now = new Date();
      return now.toTimeString().split(' ')[0];
    }

    function addToConsole(type, ...args) {
      const div = document.createElement('div');
      div.className = 'log-entry';

      const timestamp = document.createElement('span');
      timestamp.className = 'timestamp';
      timestamp.textContent = `[${getTimestamp()}]`;

      const message = document.createElement('span');
      message.className = type;
      message.textContent = args.map(a => {
        if (typeof a === 'object') {
          return JSON.stringify(a, null, 2);
        }
        return String(a);
      }).join(' ');

      div.appendChild(timestamp);
      div.appendChild(message);
      consoleOutput.appendChild(div);
      consoleOutput.scrollTop = consoleOutput.scrollHeight;
    }

    function clearConsole() {
      consoleOutput.innerHTML = `
        <div class="log-entry">
          <span class="timestamp">[${getTimestamp()}]</span>
          <span class="info">Console cleared.</span>
        </div>
      `;
    }

    function updateTestStatus() {
      const passed = Object.values(tests).filter(Boolean).length;
      const total = Object.keys(tests).length;

      const badges = [
        tests.componentLoaded ?
          '<span class="status-badge pass">‚úì Component Loaded</span>' :
          '<span class="status-badge fail">‚úó Component Loaded</span>',

        tests.componentRendered ?
          '<span class="status-badge pass">‚úì Rendered</span>' :
          '<span class="status-badge fail">‚úó Rendered</span>',

        tests.titleRendered ?
          '<span class="status-badge pass">‚úì Title Visible</span>' :
          '<span class="status-badge fail">‚úó Title Visible</span>',

        tests.locationRendered ?
          '<span class="status-badge pass">‚úì Location Visible</span>' :
          '<span class="status-badge fail">‚úó Location Visible</span>',

        tests.mapPinVisible ?
          '<span class="status-badge pass">‚úì Map Pin Icon</span>' :
          '<span class="status-badge fail">‚úó Map Pin Icon</span>',

        tests.detailsRendered ?
          '<span class="status-badge pass">‚úì Details Visible</span>' :
          '<span class="status-badge fail">‚úó Details Visible</span>'
      ];

      testStatusEl.innerHTML = badges.join('') +
        `<span class="status-badge ${passed === total ? 'pass' : 'fail'}">${passed}/${total} Tests</span>`;
    }

    // Override console methods
    const originalLog = console.log;
    const originalError = console.error;

    console.log = (...args) => {
      originalLog(...args);
      addToConsole('info', ...args);
    };

    console.error = (...args) => {
      originalError(...args);
      addToConsole('error', '‚ùå', ...args);
    };

    // Initialize
    try {
      console.log('Initializing PropertyHeader component preview...');

      if (!window.SplitLeaseComponents) {
        throw new Error('SplitLeaseComponents global not found');
      }
      tests.componentLoaded = true;
      console.log('‚úì SplitLeaseComponents global loaded');

      if (!window.SplitLeaseComponents.PropertyHeader) {
        throw new Error('PropertyHeader component not found in SplitLeaseComponents');
      }
      console.log('‚úì PropertyHeader export found');

      const PropertyHeaderComponent = window.SplitLeaseComponents.PropertyHeader;
      const rootEl = document.getElementById('property-header-root');

      const props = {
        title: 'Holiday Rental: Luxurious, Sunny, and Quiet Apt on Central Park West',
        location: {
          neighborhood: 'Manhattan Valley',
          city: 'Manhattan'
        },
        propertyType: 'Private Room',
        maxGuests: 2
      };

      const root = ReactDOM.createRoot(rootEl);
      root.render(React.createElement(PropertyHeaderComponent, props));

      tests.componentRendered = true;
      console.log('‚úì Component mounted successfully with props:', props);

      // Verify rendered elements
      setTimeout(() => {
        const titleEl = document.querySelector('.property-title');
        if (titleEl) {
          tests.titleRendered = true;
          console.log('‚úì Title element found:', titleEl.textContent);
        }

        const locationEl = document.querySelector('.property-location');
        if (locationEl) {
          tests.locationRendered = true;
          console.log('‚úì Location element found');
        }

        const mapPinEl = document.querySelector('.map-pin-icon');
        if (mapPinEl) {
          tests.mapPinVisible = true;
          console.log('‚úì Map pin icon found');
        }

        const detailsEl = document.querySelector('.property-details');
        if (detailsEl) {
          tests.detailsRendered = true;
          console.log('‚úì Property details element found:', detailsEl.textContent);
        }

        updateTestStatus();
      }, 500);

      updateTestStatus();

    } catch (error) {
      console.error('Failed to initialize PropertyHeader:', error.message);
      console.error(error.stack);
      updateTestStatus();
    }
  </script>
</body>
</html>
