<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SearchScheduleSelector Component Preview</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
      background: #f5f5f5;
      padding: 0;
      margin: 0;
    }

    .preview-header {
      background: white;
      padding: 1.5rem 2rem;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .preview-header h1 {
      font-size: 1.5rem;
      color: #111827;
      margin-bottom: 0.5rem;
    }

    .preview-header code {
      background: #F3F4F6;
      padding: 0.125rem 0.375rem;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-size: 0.8125rem;
    }

    .test-controls {
      background: white;
      padding: 1.5rem 2rem;
      margin: 1.5rem;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .test-controls h2 {
      font-size: 1.125rem;
      color: #111827;
      margin-bottom: 1rem;
    }

    .control-group {
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .control-group label {
      font-size: 0.875rem;
      color: #374151;
      min-width: 150px;
    }

    .control-group input[type="number"] {
      width: 80px;
      padding: 0.5rem;
      border: 1px solid #D1D5DB;
      border-radius: 4px;
      font-size: 0.875rem;
    }

    .control-group input[type="checkbox"] {
      width: 18px;
      height: 18px;
      cursor: pointer;
    }

    .apply-btn {
      background: #059669;
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 4px;
      font-size: 0.875rem;
      font-weight: 500;
      cursor: pointer;
      margin-top: 1rem;
    }

    .apply-btn:hover {
      background: #047857;
    }

    .component-container {
      background: white;
      margin: 1.5rem;
      padding: 3rem 2rem;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 300px;
    }

    .console-output {
      background: white;
      margin: 1.5rem;
      padding: 1.5rem;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .console-output h3 {
      font-size: 1rem;
      color: #111827;
      margin-bottom: 1rem;
    }

    .console-log {
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 1rem;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-size: 0.875rem;
      max-height: 400px;
      overflow-y: auto;
      line-height: 1.5;
    }

    .log-entry {
      margin-bottom: 0.5rem;
      padding: 0.25rem 0;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    .log-entry:last-child {
      border-bottom: none;
    }

    .timestamp {
      color: #858585;
      margin-right: 0.5rem;
    }

    .success {
      color: #4ade80;
    }

    .error {
      color: #f87171;
    }

    .info {
      color: #60a5fa;
    }

    .test-status {
      display: flex;
      gap: 0.5rem;
      margin-top: 1rem;
      flex-wrap: wrap;
    }

    .status-badge {
      padding: 0.375rem 0.75rem;
      border-radius: 4px;
      font-size: 0.8125rem;
      font-weight: 500;
    }

    .status-badge.pass {
      background: #D1FAE5;
      color: #065F46;
    }

    .status-badge.pending {
      background: #FEF3C7;
      color: #92400E;
    }

    .clear-console {
      background: #EF4444;
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.875rem;
      font-weight: 500;
      margin-top: 1rem;
    }

    .clear-console:hover {
      background: #DC2626;
    }
  </style>
</head>
<body>
  <div class="preview-header">
    <h1>üß™ SearchScheduleSelector Component Preview</h1>
    <p>Project: <strong>split-lease</strong> | Global: <code>window.SplitLeaseComponents.SearchScheduleSelector</code></p>
  </div>

  <div class="test-controls">
    <h2>üéõÔ∏è Component Configuration</h2>

    <div class="control-group">
      <label for="min-days">Min Days (nights):</label>
      <input type="number" id="min-days" value="2" min="0" max="7">
    </div>

    <div class="control-group">
      <label for="max-days">Max Days (nights):</label>
      <input type="number" id="max-days" value="5" min="0" max="7">
    </div>

    <div class="control-group">
      <label for="require-contiguous">Require Contiguous:</label>
      <input type="checkbox" id="require-contiguous" checked>
    </div>

    <button class="apply-btn" onclick="applyConfig()">Apply Configuration</button>

    <h3 style="margin-top: 1.5rem; margin-bottom: 0.75rem; font-size: 1rem;">üìã Test Status</h3>
    <div class="test-status" id="test-status">
      <span class="status-badge pending">Waiting for interactions...</span>
    </div>
  </div>

  <div class="component-container" id="selector-root"></div>

  <div class="console-output">
    <h3>üìä Console Output</h3>
    <div class="console-log" id="console-output">
      <div class="log-entry">
        <span class="timestamp">[00:00:00]</span>
        <span class="info">Console initialized. Waiting for events...</span>
      </div>
    </div>
    <button class="clear-console" onclick="clearConsole()">Clear Console</button>
  </div>

  <!-- Component CSS (CRITICAL: Must be loaded for styling) -->
  <link rel="stylesheet" href="../../split-lease/components/dist/style.css">

  <!-- React + UMD -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Node globals shim -->
  <script>
    window.global = window;
    window.process = { env: { NODE_ENV: 'production' } };
  </script>

  <!-- Component Bundle -->
  <script src="../../split-lease/components/dist/split-lease-components.umd.cjs"></script>

  <script>
    // Test tracking
    const tests = {
      componentLoaded: false,
      componentRendered: false,
      daySelected: false,
      multipleSelected: false,
      clearButtonWorks: false,
      validationWorks: false,
      callbacksFired: false
    };

    // Console capture
    const consoleOutput = document.getElementById('console-output');
    const testStatusEl = document.getElementById('test-status');

    function getTimestamp() {
      const now = new Date();
      return now.toTimeString().split(' ')[0];
    }

    function addToConsole(type, ...args) {
      const div = document.createElement('div');
      div.className = 'log-entry';

      const timestamp = document.createElement('span');
      timestamp.className = 'timestamp';
      timestamp.textContent = `[${getTimestamp()}]`;

      const message = document.createElement('span');
      message.className = type;
      message.textContent = args.map(a => {
        if (typeof a === 'object') {
          return JSON.stringify(a, null, 2);
        }
        return String(a);
      }).join(' ');

      div.appendChild(timestamp);
      div.appendChild(message);
      consoleOutput.appendChild(div);
      consoleOutput.scrollTop = consoleOutput.scrollHeight;
    }

    function clearConsole() {
      consoleOutput.innerHTML = `
        <div class="log-entry">
          <span class="timestamp">[${getTimestamp()}]</span>
          <span class="info">Console cleared.</span>
        </div>
      `;
    }

    function updateTestStatus() {
      const passed = Object.values(tests).filter(Boolean).length;
      const total = Object.keys(tests).length;

      const badges = [
        tests.componentLoaded ?
          '<span class="status-badge pass">‚úì Component Loaded</span>' :
          '<span class="status-badge pending">‚óã Component Loaded</span>',

        tests.componentRendered ?
          '<span class="status-badge pass">‚úì Rendered</span>' :
          '<span class="status-badge pending">‚óã Rendered</span>',

        tests.daySelected ?
          '<span class="status-badge pass">‚úì Day Selection</span>' :
          '<span class="status-badge pending">‚óã Day Selection</span>',

        tests.multipleSelected ?
          '<span class="status-badge pass">‚úì Multi-Select</span>' :
          '<span class="status-badge pending">‚óã Multi-Select</span>',

        tests.clearButtonWorks ?
          '<span class="status-badge pass">‚úì Clear Button</span>' :
          '<span class="status-badge pending">‚óã Clear Button</span>',

        tests.validationWorks ?
          '<span class="status-badge pass">‚úì Validation</span>' :
          '<span class="status-badge pending">‚óã Validation</span>',

        tests.callbacksFired ?
          '<span class="status-badge pass">‚úì Callbacks</span>' :
          '<span class="status-badge pending">‚óã Callbacks</span>'
      ];

      testStatusEl.innerHTML = badges.join('') +
        `<span class="status-badge ${passed === total ? 'pass' : 'pending'}">${passed}/${total} Tests</span>`;
    }

    // Override console
    const originalLog = console.log;
    const originalError = console.error;

    console.log = (...args) => {
      originalLog(...args);
      addToConsole('info', ...args);
    };

    console.error = (...args) => {
      originalError(...args);
      addToConsole('error', '‚ùå', ...args);
    };

    // Component state
    let currentRoot = null;
    let componentProps = {
      minDays: 2,
      maxDays: 5,
      requireContiguous: true,
      onSelectionChange: (selectedDays) => {
        console.log('‚úì onSelectionChange called:', selectedDays.map(d => d.fullName));
        tests.callbacksFired = true;

        if (selectedDays.length === 1 && !tests.daySelected) {
          tests.daySelected = true;
          console.log('‚úì Single day selection works');
        }

        if (selectedDays.length > 1 && !tests.multipleSelected) {
          tests.multipleSelected = true;
          console.log('‚úì Multiple day selection works');
        }

        updateTestStatus();
      },
      onError: (error) => {
        console.error('onError called:', error);
        tests.validationWorks = true;
        updateTestStatus();
      }
    };

    function renderSelector() {
      const Component = window.SplitLeaseComponents.SearchScheduleSelector;
      const rootEl = document.getElementById('selector-root');

      if (!Component) {
        console.error('SearchScheduleSelector component not found');
        return;
      }

      if (!currentRoot) {
        currentRoot = ReactDOM.createRoot(rootEl);
      }

      currentRoot.render(
        React.createElement(Component, componentProps)
      );

      console.log('‚úì Component rendered with props:', componentProps);
    }

    function applyConfig() {
      const minDays = parseInt(document.getElementById('min-days').value);
      const maxDays = parseInt(document.getElementById('max-days').value);
      const requireContiguous = document.getElementById('require-contiguous').checked;

      componentProps.minDays = minDays;
      componentProps.maxDays = maxDays;
      componentProps.requireContiguous = requireContiguous;

      console.log(`Configuration updated: minDays=${minDays}, maxDays=${maxDays}, requireContiguous=${requireContiguous}`);
      renderSelector();
    }

    // Initialize
    try {
      console.log('Initializing SearchScheduleSelector component preview...');

      if (!window.SplitLeaseComponents) {
        throw new Error('SplitLeaseComponents global not found');
      }
      tests.componentLoaded = true;
      console.log('‚úì SplitLeaseComponents global loaded');

      if (!window.SplitLeaseComponents.SearchScheduleSelector) {
        throw new Error('SearchScheduleSelector component not found');
      }
      console.log('‚úì SearchScheduleSelector export found');

      renderSelector();

      tests.componentRendered = true;
      console.log('‚úì Component mounted successfully');

      updateTestStatus();

      // Add event listener for clear button test
      setTimeout(() => {
        const clearBtn = document.querySelector('button');
        if (clearBtn && clearBtn.textContent.includes('Clear')) {
          console.log('‚úì Clear selection button found');
          // We'll test this manually
        }
      }, 1000);

      console.log('\nüìã Manual Test Instructions:');
      console.log('1. Click days to select them (watch console for callbacks)');
      console.log('2. Try selecting non-contiguous days (e.g., Mon + Wed) to see validation');
      console.log('3. Try selecting fewer than minDays or more than maxDays');
      console.log('4. Click "Clear selection" button to reset');
      console.log('5. Adjust configuration above and click "Apply Configuration"');
      console.log('6. Try drag-selecting by clicking and dragging across days');
      console.log('\n');

    } catch (error) {
      console.error('Failed to initialize component:', error.message);
      console.error(error.stack);
    }
  </script>
</body>
</html>
