<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Footer Component Preview - Split Lease</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
      background: #f5f5f5;
      padding: 0;
      margin: 0;
    }

    .preview-header {
      background: white;
      padding: 1.5rem 2rem;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .preview-header h1 {
      font-size: 1.5rem;
      color: #111827;
      margin-bottom: 0.5rem;
    }

    .preview-header p {
      color: #6B7280;
      font-size: 0.875rem;
    }

    .preview-header code {
      background: #F3F4F6;
      padding: 0.125rem 0.375rem;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-size: 0.8125rem;
    }

    .test-controls {
      background: white;
      padding: 1.5rem 2rem;
      margin: 1.5rem;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .test-controls h2 {
      font-size: 1.125rem;
      color: #111827;
      margin-bottom: 1rem;
    }

    .control-group {
      margin-bottom: 1rem;
    }

    .control-group label {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      cursor: pointer;
      padding: 0.5rem;
      border-radius: 4px;
      transition: background 0.2s;
    }

    .control-group label:hover {
      background: #F9FAFB;
    }

    .control-group input[type="checkbox"] {
      width: 18px;
      height: 18px;
      cursor: pointer;
    }

    .spacer {
      height: 2rem;
      background: #f5f5f5;
    }

    .component-container {
      background: white;
      margin: 0;
    }

    .console-output {
      background: white;
      margin: 1.5rem;
      padding: 1.5rem;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .console-output h3 {
      font-size: 1rem;
      color: #111827;
      margin-bottom: 1rem;
    }

    .console-log {
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 1rem;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-size: 0.875rem;
      max-height: 400px;
      overflow-y: auto;
      line-height: 1.5;
    }

    .console-log .log-entry {
      margin-bottom: 0.5rem;
      padding: 0.25rem 0;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    .console-log .log-entry:last-child {
      border-bottom: none;
    }

    .console-log .timestamp {
      color: #858585;
      margin-right: 0.5rem;
    }

    .console-log .success {
      color: #4ade80;
    }

    .console-log .error {
      color: #f87171;
    }

    .console-log .info {
      color: #60a5fa;
    }

    .test-status {
      display: flex;
      gap: 0.5rem;
      margin-top: 1rem;
      flex-wrap: wrap;
    }

    .status-badge {
      padding: 0.375rem 0.75rem;
      border-radius: 4px;
      font-size: 0.8125rem;
      font-weight: 500;
    }

    .status-badge.pass {
      background: #D1FAE5;
      color: #065F46;
    }

    .status-badge.fail {
      background: #FEE2E2;
      color: #991B1B;
    }

    .status-badge.pending {
      background: #FEF3C7;
      color: #92400E;
    }

    .clear-console {
      background: #EF4444;
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.875rem;
      font-weight: 500;
      margin-top: 1rem;
      transition: background 0.2s;
    }

    .clear-console:hover {
      background: #DC2626;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <div class="preview-header">
    <h1>üß™ Footer Component Preview</h1>
    <p>Project: <strong>split-lease</strong> | Global: <code>window.SplitLeaseComponents.Footer</code></p>
  </div>

  <!-- Test Controls -->
  <div class="test-controls">
    <h2>üéõÔ∏è Component Configuration</h2>
    <div class="control-group">
      <label>
        <input type="checkbox" id="toggle-referral" checked>
        <span>Show Referral Form</span>
      </label>
    </div>
    <div class="control-group">
      <label>
        <input type="checkbox" id="toggle-import" checked>
        <span>Show Import Form</span>
      </label>
    </div>

    <h3 style="margin-top: 1.5rem; margin-bottom: 0.75rem; font-size: 1rem;">üìã Test Status</h3>
    <div class="test-status" id="test-status">
      <span class="status-badge pending">Waiting for interactions...</span>
    </div>
  </div>

  <div class="spacer"></div>

  <!-- Component Container -->
  <div class="component-container" id="footer-root"></div>

  <!-- Console Output -->
  <div class="console-output">
    <h3>üìä Console Output</h3>
    <div class="console-log" id="console-output">
      <div class="log-entry">
        <span class="timestamp">[00:00:00]</span>
        <span class="info">Console initialized. Waiting for events...</span>
      </div>
    </div>
    <button class="clear-console" onclick="clearConsole()">Clear Console</button>
  </div>

  <!-- Component CSS (CRITICAL: Must be loaded for styling) -->
  <link rel="stylesheet" href="../../split-lease/components/dist/style.css">

  <!-- React + UMD -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Node globals shim -->
  <script>
    window.global = window;
    window.process = { env: { NODE_ENV: 'production' } };
  </script>

  <!-- Component Bundle -->
  <script src="../../split-lease/components/dist/split-lease-components.umd.cjs"></script>

  <!-- Preview Logic -->
  <script>
    // Test tracking
    const tests = {
      componentLoaded: false,
      componentRendered: false,
      referralSubmitted: false,
      importSubmitted: false,
      urlValidationWorks: false,
      emailValidationWorks: false
    };

    // Console capture
    const consoleOutput = document.getElementById('console-output');
    const testStatusEl = document.getElementById('test-status');
    let logCounter = 0;

    function getTimestamp() {
      const now = new Date();
      return now.toTimeString().split(' ')[0];
    }

    function addToConsole(type, ...args) {
      const div = document.createElement('div');
      div.className = 'log-entry';

      const timestamp = document.createElement('span');
      timestamp.className = 'timestamp';
      timestamp.textContent = `[${getTimestamp()}]`;

      const message = document.createElement('span');
      message.className = type;
      message.textContent = args.map(a => {
        if (typeof a === 'object') {
          return JSON.stringify(a, null, 2);
        }
        return String(a);
      }).join(' ');

      div.appendChild(timestamp);
      div.appendChild(message);
      consoleOutput.appendChild(div);
      consoleOutput.scrollTop = consoleOutput.scrollHeight;

      logCounter++;
    }

    function clearConsole() {
      consoleOutput.innerHTML = `
        <div class="log-entry">
          <span class="timestamp">[${getTimestamp()}]</span>
          <span class="info">Console cleared.</span>
        </div>
      `;
      logCounter = 0;
    }

    function updateTestStatus() {
      const passed = Object.values(tests).filter(Boolean).length;
      const total = Object.keys(tests).length;

      const badges = [
        tests.componentLoaded ?
          '<span class="status-badge pass">‚úì Component Loaded</span>' :
          '<span class="status-badge fail">‚úó Component Loaded</span>',

        tests.componentRendered ?
          '<span class="status-badge pass">‚úì Rendered</span>' :
          '<span class="status-badge fail">‚úó Rendered</span>',

        tests.referralSubmitted ?
          '<span class="status-badge pass">‚úì Referral Works</span>' :
          '<span class="status-badge pending">‚óã Referral Pending</span>',

        tests.importSubmitted ?
          '<span class="status-badge pass">‚úì Import Works</span>' :
          '<span class="status-badge pending">‚óã Import Pending</span>',

        tests.urlValidationWorks ?
          '<span class="status-badge pass">‚úì URL Validation</span>' :
          '<span class="status-badge pending">‚óã URL Validation</span>',

        tests.emailValidationWorks ?
          '<span class="status-badge pass">‚úì Email Validation</span>' :
          '<span class="status-badge pending">‚óã Email Validation</span>'
      ];

      testStatusEl.innerHTML = badges.join('') +
        `<span class="status-badge ${passed === total ? 'pass' : 'pending'}">${passed}/${total} Tests</span>`;
    }

    // Override console methods
    const originalLog = console.log;
    const originalError = console.error;
    const originalWarn = console.warn;

    console.log = (...args) => {
      originalLog(...args);
      addToConsole('info', ...args);
    };

    console.error = (...args) => {
      originalError(...args);
      addToConsole('error', '‚ùå', ...args);
    };

    console.warn = (...args) => {
      originalWarn(...args);
      addToConsole('error', '‚ö†Ô∏è', ...args);
    };

    // Component state
    let currentRoot = null;
    let componentProps = {
      showReferral: true,
      showImport: true,
      onReferralSubmit: (method, contact) => {
        console.log('‚úì onReferralSubmit called:', { method, contact });
        tests.referralSubmitted = true;
        updateTestStatus();
      },
      onImportSubmit: (url, email) => {
        console.log('‚úì onImportSubmit called:', { url, email });
        tests.importSubmitted = true;
        updateTestStatus();
      }
    };

    function renderFooter() {
      const FooterComponent = window.SplitLeaseComponents.Footer;
      const rootEl = document.getElementById('footer-root');

      if (!FooterComponent) {
        console.error('Footer component not found in window.SplitLeaseComponents');
        return;
      }

      if (!currentRoot) {
        currentRoot = ReactDOM.createRoot(rootEl);
      }

      currentRoot.render(
        React.createElement(FooterComponent, componentProps)
      );

      console.log('‚úì Footer component rendered with props:', componentProps);
    }

    // Test controls
    document.getElementById('toggle-referral').addEventListener('change', (e) => {
      componentProps.showReferral = e.target.checked;
      console.log(`Referral form ${e.target.checked ? 'shown' : 'hidden'}`);
      renderFooter();
    });

    document.getElementById('toggle-import').addEventListener('change', (e) => {
      componentProps.showImport = e.target.checked;
      console.log(`Import form ${e.target.checked ? 'shown' : 'hidden'}`);
      renderFooter();
    });

    // Initialize
    try {
      console.log('Initializing Footer component preview...');

      if (!window.SplitLeaseComponents) {
        throw new Error('SplitLeaseComponents global not found');
      }
      tests.componentLoaded = true;
      console.log('‚úì SplitLeaseComponents global loaded');

      if (!window.SplitLeaseComponents.Footer) {
        throw new Error('Footer component not found in SplitLeaseComponents');
      }
      console.log('‚úì Footer export found');

      renderFooter();

      tests.componentRendered = true;
      console.log('‚úì Component mounted successfully');

      updateTestStatus();

      // Instructions
      console.log('\nüìã Manual Test Instructions:');
      console.log('1. Test referral form: Select text/email, enter contact, click "Share now"');
      console.log('2. Test import form: Enter URL (must start with http(s)) and email (must have @ and .)');
      console.log('3. Test validation: Try invalid URL (no http) or invalid email (no @)');
      console.log('4. Toggle forms using checkboxes above');
      console.log('\n');

    } catch (error) {
      console.error('Failed to initialize Footer:', error.message);
      console.error(error.stack);
    }
  </script>
</body>
</html>
